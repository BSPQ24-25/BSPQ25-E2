<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title data-i18n="add_playlist_title">Add Playlist</title>
  <link rel="stylesheet" href="styles.css">
  <script src="i18n.js" defer></script>
</head>
<body class="centered-page">
  <div style="position: absolute; top: 10px; right: 20px;">
    <button onclick="loadTranslations('es')" title="EspaÃ±ol">Es</button>
    <button onclick="loadTranslations('en')" title="English">En</button>
    <button onclick="loadTranslations('eu')" title="Euskara">Eu</button>
  </div>

  <h2 data-i18n="add_playlist_title">Create a New Playlist</h2>

  <form id="addPlaylistForm" onsubmit="createPlaylist(event)">
    <label for="name" data-i18n="add_playlist_name">Name:</label>
    <input type="text" id="name" required>
    <br>

    <label for="profile_id" data-i18n="add_playlist_profile">Profile ID:</label>
    <input type="number" id="profile_id" disabled>
    <br>

    <div style="margin-bottom: 1rem;">
      <label for="is_public" data-i18n="add_playlist_public" style="display: block; font-weight: bold; margin-bottom: 0.2rem;">Public:</label>
      <input type="checkbox" id="is_public" style="transform: scale(1.2);">
    </div>

    <button type="submit" data-i18n="add_playlist_button">Create</button>
  </form>

  <script>
    const full = window.location.origin;
    const match = full.match(/^(https?:\/\/[^\/:]+)/);
    const appUrl = match ? match[0] : '';
    document.addEventListener("DOMContentLoaded", () => {
      const userId = localStorage.getItem("userId");
      if (userId) {
        document.getElementById("profile_id").value = userId;
      }
    });

    async function createPlaylist(event) {
      event.preventDefault();
    
      const token = localStorage.getItem("token");
      const username = localStorage.getItem("username");  
    
      const playlist = {
        name: document.getElementById("name").value,
        number_of_songs: 0,
        is_public: document.getElementById("is_public").checked,
        owners: [username]
      };
    
      const response = await fetch(`${appUrl || "http://localhost"}:8080/api/playlists`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify(playlist)
      });
    
      if (response.ok) {
        alert(t('playlist.created.successfully'));
        window.location.href = "playlists.html";
      } else {
        alert(t('playlist.created.failed'));
      }
    }
  </script>
</body>
</html>