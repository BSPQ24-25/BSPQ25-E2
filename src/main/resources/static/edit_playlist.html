<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Edit Playlist</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="centered-page">
  <h2>Edit Playlist</h2>

  <label for="playlistSelect">Choose a playlist:</label>
  <select id="playlistSelect" size="5" required></select>

  <form id="editPlaylistForm" style="margin-top: 2rem;">
    <label for="profile_id">Profile ID:</label>
    <input type="number" id="profile_id" required>

    <label for="number_of_songs">Number of Songs:</label>
    <input type="number" id="number_of_songs" required>

    <label for="is_public">Public:</label>
    <input type="checkbox" id="is_public">

    <button type="submit">Save Changes</button>
  </form>

  <script>
    const select = document.getElementById("playlistSelect");
    let playlists = [];

    fetch("http://localhost:8080/api/playlists")
      .then(res => res.json())
      .then(data => {
        playlists = data;
        data.forEach(pl => {
          const option = document.createElement("option");
          option.value = pl.id;
          option.textContent = `Playlist #${pl.id}`;
          select.appendChild(option);
        });
      });

    select.addEventListener("change", () => {
      const selected = playlists.find(p => p.id == select.value);
      if (selected) {
        document.getElementById("profile_id").value = selected.profile_id;
        document.getElementById("number_of_songs").value = selected.number_of_songs;
        document.getElementById("is_public").checked = selected.is_public;
      }
    });

    document.getElementById("editPlaylistForm").addEventListener("submit", function(event) {
      event.preventDefault();
      const playlistId = select.value;
      const updated = {
        profile_id: parseInt(document.getElementById("profile_id").value),
        number_of_songs: parseInt(document.getElementById("number_of_songs").value),
        is_public: document.getElementById("is_public").checked
      };

      fetch(`http://localhost:8080/api/playlists/${playlistId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updated)
      }).then(() => window.location.href = "playlists.html");
    });
  </script>
</body>
</html>
